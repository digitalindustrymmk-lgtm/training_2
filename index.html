<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>បញ្ជីឈ្មោះ Training_វគ្គ២</title>
    
    <!-- Google Fonts: Kantumruy Pro -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kantumruy+Pro:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Custom Styles -->
    <style>
        body {
            font-family: "Kantumruy Pro", sans-serif;
        }
        @keyframes fade-in-up {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        .animate-card {
            animation: fade-in-up 0.5s ease-out forwards;
            opacity: 0;
        }
    </style>

    <!-- React & ReactDOM & Babel -->
    <script type="importmap">
        {
            "imports": {
                "react": "https://esm.sh/react@18.2.0",
                "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
                "firebase/app": "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js",
                "firebase/database": "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js",
                "lucide-react": "https://esm.sh/lucide-react@0.378.0"
            }
        }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { initializeApp } from 'firebase/app';
        import { getDatabase, ref, onValue } from 'firebase/database';
        import { 
            Users, Phone, MapPin, Calendar, ExternalLink, Search, User, X, Send, Sparkles 
        } from 'lucide-react';

        // 1. Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCSCL7yNCMAuoqliqmDq24FrrfkvAxLBz4",
            authDomain: "itinfo-8501a.firebaseapp.com",
            databaseURL: "https://itinfo-8501a-default-rtdb.firebaseio.com",
            projectId: "itinfo-8501a",
            storageBucket: "itinfo-8501a.firebasestorage.app",
            messagingSenderId: "829674637790",
            appId: "1:829674637790:web:0ae1c4cd27b1e35a14f54f",
            measurementId: "G-VYXZXBHWFT"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        function App() {
            const [users, setUsers] = useState([]);
            const [loading, setLoading] = useState(true);
            const [searchTerm, setSearchTerm] = useState('');

            useEffect(() => {
                const usersRef = ref(db, 'users');
                const unsubscribe = onValue(usersRef, (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        const userList = Object.keys(data).map(key => ({
                            id: key,
                            ...data[key]
                        }));
                        setUsers(userList);
                    } else {
                        setUsers([]);
                    }
                    setLoading(false);
                }, (error) => {
                    console.error("Error fetching data:", error);
                    setLoading(false);
                });
                return () => unsubscribe();
            }, []);

            const filteredUsers = users.filter(user => 
                user.khmer_name?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                user.first_name?.toLowerCase().includes(searchTerm.toLowerCase()) ||
                user.phone_number?.includes(searchTerm)
            );

            return (
                <div className="min-h-screen bg-gradient-to-br from-indigo-50 via-white to-cyan-50 pb-20 selection:bg-blue-100">
                    {/* Modern Glass Header */}
                    <div className="sticky top-0 z-30 bg-white/80 backdrop-blur-xl border-b border-white/50 shadow-sm transition-all duration-300">
                        <div className="max-w-3xl mx-auto px-4 py-4">
                            <div className="flex flex-col gap-4">
                                
                                {/* Title Section */}
                                <div className="flex items-center justify-between">
                                    <div className="flex items-center gap-3">
                                        <div className="bg-gradient-to-tr from-blue-600 to-cyan-500 p-2.5 rounded-xl text-white shadow-lg shadow-blue-500/30">
                                            <Users size={22} />
                                        </div>
                                        <div>
                                            <h1 className="text-2xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 bg-clip-text text-transparent">
                                                បញ្ជីឈ្មោះ Training_វគ្គ២
                                            </h1>
                                        </div>
                                    </div>
                                    <div className="flex items-center gap-2 bg-blue-50/80 px-4 py-1.5 rounded-full border border-blue-100">
                                        <span className="relative flex h-2.5 w-2.5">
                                            <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
                                            <span className="relative inline-flex rounded-full h-2.5 w-2.5 bg-blue-500"></span>
                                        </span>
                                        <span className="text-sm font-semibold text-blue-700 pt-0.5">
                                            {users.length} នាក់
                                        </span>
                                    </div>
                                </div>

                                {/* Modern Search Bar */}
                                <div className="relative group">
                                    <div className="absolute inset-0 bg-gradient-to-r from-blue-200 to-cyan-200 rounded-2xl blur opacity-25 group-focus-within:opacity-50 transition duration-300"></div>
                                    <div className="relative bg-white rounded-2xl shadow-sm border border-gray-100 flex items-center p-1 focus-within:ring-2 focus-within:ring-blue-100 transition-all">
                                        <div className="pl-3 text-gray-400">
                                            <Search size={20} />
                                        </div>
                                        <input
                                            type="text"
                                            placeholder="ស្វែងរកឈ្មោះ ឬលេខទូរស័ព្ទ..."
                                            className="w-full px-3 py-2.5 bg-transparent border-none outline-none text-gray-700 placeholder-gray-400 font-medium"
                                            value={searchTerm}
                                            onChange={(e) => setSearchTerm(e.target.value)}
                                        />
                                        {searchTerm && (
                                            <button 
                                                onClick={() => setSearchTerm('')}
                                                className="p-2 mr-1 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-xl transition-colors"
                                            >
                                                <X size={16} />
                                            </button>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Content Area */}
                    <div className="max-w-3xl mx-auto px-4 mt-6">
                        {loading ? (
                            <div className="space-y-4">
                                {[1, 2, 3].map(i => (
                                    <div key={i} className="bg-white/60 p-4 rounded-3xl h-44 w-full animate-pulse border border-white shadow-sm"></div>
                                ))}
                            </div>
                        ) : (
                            <div className="grid gap-5">
                                {filteredUsers.map((user, index) => (
                                    <div 
                                        key={user.id} 
                                        className="animate-card group relative bg-white/90 backdrop-blur-sm rounded-3xl p-5 border border-gray-100/50 shadow-[0_2px_20px_-12px_rgba(0,0,0,0.1)] hover:shadow-[0_8px_30px_-12px_rgba(0,0,0,0.2)] hover:-translate-y-1 transition-all duration-300"
                                        style={{ animationDelay: `${index * 0.1}s` }}
                                    >
                                        
                                        {/* Decorative background shape */}
                                        <div className="absolute top-0 right-0 w-32 h-32 bg-gradient-to-bl from-blue-50/50 to-transparent rounded-tr-3xl rounded-bl-[100px] pointer-events-none"></div>

                                        {/* User Header Info */}
                                        <div className="relative flex justify-between items-start mb-4">
                                            <div className="flex gap-4">
                                                {/* Modern Avatar */}
                                                <div className="relative">
                                                    <div className="w-16 h-16 bg-gradient-to-br from-blue-100 to-white rounded-2xl flex items-center justify-center text-blue-600 font-bold text-2xl shadow-inner border border-white ring-4 ring-blue-50/50">
                                                        {user.khmer_name ? user.khmer_name.charAt(0) : <User size={28}/>}
                                                    </div>
                                                    <div className={`absolute -bottom-1 -right-1 w-5 h-5 border-4 border-white rounded-full ${user.status === 'completed' ? 'bg-green-500' : 'bg-yellow-500'}`}></div>
                                                </div>
                                                
                                                {/* Name & Badge */}
                                                <div className="pt-1">
                                                    <h3 className="font-bold text-gray-800 text-lg leading-tight tracking-tight group-hover:text-blue-600 transition-colors">
                                                        {user.khmer_name || "គ្មានឈ្មោះ"}
                                                    </h3>
                                                    <p className="text-gray-500 font-medium text-sm">
                                                        {user.first_name} {user.last_name}
                                                    </p>
                                                    <div className="mt-2">
                                                        <span className={`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-lg text-[11px] font-semibold uppercase tracking-wider ${
                                                            user.status === 'completed' 
                                                                ? 'bg-green-50 text-green-700 ring-1 ring-green-500/20' 
                                                                : 'bg-yellow-50 text-yellow-700 ring-1 ring-yellow-500/20'
                                                        }`}>
                                                            {user.status === 'completed' ? (
                                                                <>
                                                                    <div className="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></div>
                                                                    Completed
                                                                </>
                                                            ) : user.status}
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Details Grid */}
                                        <div className="grid grid-cols-1 gap-2.5 bg-gray-50/80 p-4 rounded-2xl border border-gray-100 mb-5 group-hover:bg-blue-50/30 transition-colors duration-300">
                                            <div className="flex items-center gap-3 text-gray-700 text-sm">
                                                <div className="p-1.5 bg-white rounded-lg shadow-sm text-red-500">
                                                    <MapPin size={16} />
                                                </div>
                                                <span className="font-medium truncate pt-0.5">{user.province || "មិនមានទីតាំង"}</span>
                                            </div>
                                            
                                            {user.joined_at && (
                                                <div className="flex items-center gap-3 text-gray-700 text-sm">
                                                    <div className="p-1.5 bg-white rounded-lg shadow-sm text-orange-500">
                                                        <Calendar size={16} />
                                                    </div>
                                                    <span className="font-medium pt-0.5">{new Date(user.joined_at).toLocaleDateString('km-KH')}</span>
                                                </div>
                                            )}

                                            <div className="flex items-center gap-3 text-gray-700 text-sm">
                                                <div className="p-1.5 bg-white rounded-lg shadow-sm text-green-600">
                                                    <Phone size={16} />
                                                </div>
                                                <span className="font-medium font-mono tracking-wide pt-0.5">{user.phone_number || "មិនមានលេខ"}</span>
                                            </div>
                                        </div>

                                        {/* Action Buttons */}
                                        <div className="grid grid-cols-2 gap-3">
                                            {user.phone_number && (
                                                <a 
                                                    href={`tel:${user.phone_number}`}
                                                    className="relative overflow-hidden flex items-center justify-center gap-2 bg-white border border-gray-200 text-gray-700 py-3 rounded-xl font-semibold text-sm hover:bg-green-50 hover:text-green-700 hover:border-green-200 active:scale-[0.98] transition-all duration-200 shadow-sm"
                                                >
                                                    <Phone size={18} />
                                                    <span className="pt-0.5">ហៅចេញ</span>
                                                </a>
                                            )}
                                            
                                            {user.link ? (
                                                <a 
                                                    href={user.link} 
                                                    target="_blank" 
                                                    rel="noreferrer"
                                                    className="relative overflow-hidden flex items-center justify-center gap-2 bg-gradient-to-r from-blue-600 to-blue-500 text-white py-3 rounded-xl font-semibold text-sm shadow-lg shadow-blue-500/30 hover:shadow-blue-500/50 hover:brightness-110 active:scale-[0.98] transition-all duration-200"
                                                >
                                                    <Send size={18} />
                                                    <span className="pt-0.5">Telegram</span>
                                                    <div className="absolute inset-0 bg-white/20 translate-y-full hover:translate-y-0 transition-transform duration-300"></div>
                                                </a>
                                            ) : (
                                                <button disabled className="flex items-center justify-center gap-2 bg-gray-100 text-gray-400 py-3 rounded-xl font-semibold text-sm cursor-not-allowed">
                                                    <Send size={18} />
                                                    <span className="pt-0.5">Telegram</span>
                                                </button>
                                            )}
                                        </div>

                                    </div>
                                ))}
                            </div>
                        )}

                        {/* Empty State with Animation */}
                        {!loading && filteredUsers.length === 0 && (
                            <div className="flex flex-col items-center justify-center py-24 text-center px-4 animate-card">
                                <div className="relative mb-6">
                                    <div className="absolute inset-0 bg-blue-200 blur-xl opacity-30 rounded-full animate-pulse"></div>
                                    <div className="relative bg-white p-6 rounded-3xl shadow-lg border border-gray-100">
                                        <Sparkles size={40} className="text-blue-500" />
                                    </div>
                                </div>
                                <h3 className="text-xl font-bold text-gray-800 mb-2">រកមិនឃើញទិន្នន័យ</h3>
                                <p className="text-gray-500 text-sm max-w-xs mx-auto mb-8">
                                    មិនមានឈ្មោះ "{searchTerm}" នៅក្នុងបញ្ជីទេ។ សូមពិនិត្យអក្ខរាវិរុទ្ធម្តងទៀត។
                                </p>
                                <button 
                                    onClick={() => setSearchTerm('')}
                                    className="px-6 py-2.5 bg-white border border-gray-200 text-gray-700 font-semibold rounded-xl shadow-sm hover:bg-gray-50 hover:scale-105 transition-all"
                                >
                                    បង្ហាញទាំងអស់វិញ
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
